<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Workshop OOP</title>

    <meta name="description" content="Workshop OOP">
    <meta name="author" content="Bernardo Fontes">

    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <link rel="stylesheet" href="../css/reveal.min.css">
    <link rel="stylesheet" href="../css/theme/simple.css" id="theme">

    <!-- For syntax highlighting -->
    <link rel="stylesheet" href="../lib/css/zenburn.css">

    <!-- If the query includes 'print-pdf', include the PDF print sheet -->
    <script>
    	if( window.location.search.match( /print-pdf/gi ) ) {
    		var link = document.createElement( 'link' );
    		link.rel = 'stylesheet';
    		link.type = 'text/css';
    		link.href = '../css/print/pdf.css';
    		document.getElementsByTagName( 'head' )[0].appendChild( link );
    	}
    </script>
    <style type="text/css">
      .reveal h1, .reveal h2, .reveal h3, .reveal h4, .reveal h5, .reveal h6 {
        text-transform: none !important;
      }
      .reveal section img {
        border: none !important;
        box-shadow: none !important;
      }
      .reveal .progress span {
        background: #FF0000 !important;
      }

      .without_ul_style > ul {
        list-style-type: none;
      }
    </style>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-63105879-1', 'auto');
      ga('send', 'pageview');
    </script>

    <!--[if lt IE 9]>
    <script src="../lib/js/html5shiv.js"></script>
    <![endif]-->
  </head>

  <body>

    <div class="reveal">

      <div class="slides">
      <!-- Any section element inside of this container is displayed as a slide -->

        <section>
          <h3><b>Workshop OOP</b></h3>
          <br>

          <h3>Bernardo Fontes</h3>
          <br>

          <img src="images/labcodes.png">
        </section>

        <section data-markdown class='fragments without_ul_style'>
          ## Brainstorm

          ### O que é OOP (Object Oriented Programming) para nós?
        </section>

        <section class="fragments without_ul_style" data-markdown>
          ## Dissenso
          - Há um dissenso acadêmico sobre o tema
          - Não existir uma visão consolidada viabiliza qualquer visão
          - Salda mista conceitual
          - Influência no design das linguagem
        </section>

        <section data-markdown>
          ## Interfaces em Java
          ```
          interface Animal {
              public void eat();
              public void travel();
          }
          ```
        </section>

        <section data-markdown>
          ## Interfaces em Java
          ```
          public class MammalInt implements Animal {

            public void eat() {
               System.out.println("Mammal eats");
            }

            public void travel() {
               System.out.println("Mammal travels");
            }

            public int noOfLegs() {
               return 0;
            }

          }
          ```
        </section>

        <section>
          <h2>Interfaces em Python</h2>
          <img src="images/pep.png">
        </section>

        <section>
          <h2>Interfaces em Python</h2>
          <img src="images/pep-rej.png">
        </section>

        <section class="fragments without_ul_style" data-markdown>
          ## Resumão

          - Se nem a academia concorda, não somos nós que iremos definir OOP do jeito certo
          - Afinal, não há jeito certo
          - Só nos resta fazer do jeito que convém
        </section>

        <section class="fragments without_ul_style" data-markdown>
          ### OOP por Kristen Nygaard (Simula)

          The notion of a **physical model** should be taken literally. Most people can imagine the construction of physical models by means of, for example, **Lego bricks**. In the same way, a **program execution** may be viewed as a physical model. Other perspectives on programming are made precise by some underlying model defining equations, relations, predicates, etc. **For object-oriented programming, however, we have to elaborate on the concept of physical models**.

          [Referência](http://wiki.c2.com/?NygaardClassification)
        </section>

        <section class="fragments without_ul_style" data-markdown>
          ### Polimorfismo, Encapsulamento e Herança

          - Conceitos que se entenderam como **obrigatórios** para OOP
          - Foco em construir as **peças de lego**
          - Visão e justificativa que se adequava muito ao modelo de venda de software pré-internet
          - [Referência](http://wiki.c2.com/?PolymorphismEncapsulationInheritance)
        </section>

        <section class="fragments without_ul_style" data-markdown>
          ### Uncle Bob (em 2001)

          - "I define Object Oriented programming as programming in which abstractions are independent, and concrete modules depend upon them. i.e. **Dependency Inversion**"
          - Outra maneira, porém mais arquitetural, de viabilizar as peças de lego
          - [Referência](http://wiki.c2.com/?PolymorphismEncapsulationInheritance)
        </section>

        <section class="fragments without_ul_style" data-markdown>
          ### Alan Kay (criador do termo OOP e da Small Talk)

          "OOP to me means only **messaging**, **local retention** and **protection** and **hiding of state-process**, and extreme **late-binding** of all things. It can be done in Smalltalk and in LISP. There are possibly other systems in which this is possible, but I'm not aware of them."

          [Referência](http://userpage.fu-berlin.de/~ram/pub/pub_jf47ht81Ht/doc_kay_oop_en)
        </section>

        <section class="fragments without_ul_style" data-markdown>
          ### Em termos de objeto:

          - **state-process**: mais ou menos ~conjunto de dados~
          - **messaging**: conjunto de métodos
          - **late-biding**: calma, já chegamos lá
        </section>

        <section class="fragments without_ul_style" data-markdown>
          ### Por que mais ou menos conjunto de dados?

          - Podemos traduzir state process para **estado em curso**, ou seja, ele é mutável
          - O estado é uma leitura **qualitativa do total de dados** de um objeto
          - Se um dos dados do objeto, por exemplo o saldo em uma conta bancária, muda, o estado precisa ser **"reavaliado"**
          - O estado ideal é sempre um **estado válido** para o domínio e isso é **sempre relativo**
          - Uma conta com saldo negativo poder existir configura um **estado válido em uma conta corrente**, mas **não em uma conta de poupança**.
        </section>

        <section class="fragments without_ul_style" data-markdown>
          ### Exemplo 001

          Em um sistema de GPS, dada uma latitude e longitude, preciso conseguir calcular a distância e a direção até uma outra posição de latitude e longitude.

          [Referência](https://www.javaworld.com/article/2075271/encapsulation-is-not-information-hiding.html)
        </section>

        <section class="fragments without_ul_style" data-markdown>
          ### Exemplo 001

          Em um **sistema de GPS**, dada uma posição com sua **latitude e longitude**, preciso conseguir calcular a **distância** e a **direção** até uma outra **posição**.

          [Referência](https://www.javaworld.com/article/2075271/encapsulation-is-not-information-hiding.html)
        </section>

        <section class="fragments without_ul_style" data-markdown>
          ### Exemplo 001 - o que acham?

          ```python
          class Posicao():

              def __init__(self, lat, lng):
                  self.lat, self.lng = lat, lng

          def distancia(pos_1, pos_2):
              #### implementação do cálculo de distância

          def direcao(pos_1, pos_2):
              #### implementação do cálculo de direção

          p1 = Posicao(12.0123, 36.12313)
          p2 = Posicao(12.5123, 34.00000)

          dist = distancia(p1, p2)
          direcao = direcao(p1, p2)

          print(f"Distância {p1} até {p2} é de {dist}")
          print(f"Direção de {p1} até {p2} é de {direcao} graus")
          ```
        </section>

        <section class="fragments without_ul_style" data-markdown>
          ### Comentários

          - `Posicao` é somente uma **estrutura de dados**
          - Estamos usando **objetos**, mas num código estritamente **procedural**
          - Podemos criar **estados inválidos**, exemplo, `Posicao(-50000000, 500000000)`
          - Jargão clássico: **problemas de encapsulamento**
        </section>

        <section class="fragments without_ul_style" data-markdown>
          ### Encapsulamento 101

          A language mechanism for restricting **direct access to the object's data**
        </section>

        <section class="fragments without_ul_style" data-markdown>
          ### Noções da primeira definição

          - Limita a discussão de encapsulamento **aos dados** e a maneira como são expostos
          - Atributos possuem **restrições**:
            - `public` o atributo é externamente acessível e modificável
            - `protect` o atributo é externamente acessível e internamente modificável
            - `private` o atributo é somente internamente acessível e internamente
          - Construções de **métodos de acesso** (`get` ou `set`) para modificar seus valores
          - **Nem todas as linguagens** viabilizam esses 3 estados
          - "Protected" em Python: `self._varname` como convenção
          - "Private" em Python: `self.__varname`
        </section>

        <section data-markdown>
            *Never, ever use two leading underscores. This is annoyingly private. If name clashes are a concern, use explicit name mangling instead (e.g., _MyThing_blahblah). This is essentially the same thing as double-underscore, only it's transparent where double underscore obscures.*

            [Ian Bicking - Paste Style Guide](https://paste.readthedocs.io/en/latest/StyleGuide.html)
        </section>

        <section class="fragments without_ul_style" data-markdown>
          ### Exemplo 002 - o que acham?

          ```python
          class Posicao():

              def __init__(self, lat, lng):
                  self.lat, self.lng = lat, lng

              @property
              def lat(self):
                return self._lat

              @lat.setter
              def lat(self, value):
                if not -90 <= value <= 90:
                  raise ValueError("Latitude inválida")
                self._lat = value

              @property
              def lng(self):
                return self._lng

              @lng.setter
              def lng(self, value):
                if not -180 <= value <= 180:
                  raise ValueError("Longitude inválida")
                self._lng = value

          def distancia(pos_1, pos_2):
              #### implementação do cálculo de distância

          def direcao(pos_1, pos_2):
              #### implementação do cálculo de direção

          p1 = Posicao(12.0123, 36.12313)
          p2 = Posicao(12.5123, 34.00000)

          dist = distancia(p1, p2)
          direcao = direcao(p1, p2)

          print(f"Distância {p1} até {p2} é de {dist}")
          print(f"Direção de {p1} até {p2} é de {direcao} graus")
          ```
        </section>

        <section class="fragments without_ul_style" data-markdown>
          ### Comentários

          - Encapsulamento torna **difícil gerar estados inválidos**
          - Continuamos utilizando **código estrutal**
          - `Posicao` continua sendo uma **estrutura de dados**, só que agora **com restrições** (constraints)
          - De acordo com a visão sobre encapsulamento, mas **permitindo que objetos externos operem** diretamente com os dados de `Posicao`
        </section>

        <section class="fragments without_ul_style" data-markdown>
          ### Refinando o que é encapsulamento

          - Só **encapsular dados** não implica necessariamente em ter um bom código OOP
          - Melhorando a definição: *A language construct that facilitates the **bundling of data** with the **methods operating on that data***
          - Como melhorar o exemplo [002](#/20)?
        </section>

        <section class="fragments without_ul_style" data-markdown>
          ### Exemplo 003 - o que acham?

          ```python
          class Posicao():

              def __init__(self, lat, lng):
                  self.lat, self.lng = lat, lng

              @property
              def lat(self):
                return self._lat

              @lat.setter
              def lat(self, value):
                if not -90 <= value <= 90:
                  raise ValueError("Latitude inválida")
                self._lat = value

              @property
              def lng(self):
                return self._lng

              @lng.setter
              def lng(self, value):
                if not -180 <= value <= 180:
                  raise ValueError("Longitude inválida")
                self._lng = value

              def distancia(self, pos):
                  #### implementação do cálculo de distância

              def direcao(self, pos):
                  #### implementação do cálculo de direção

          p1 = Posicao(12.0123, 36.12313)
          p2 = Posicao(12.5123, 34.00000)

          dist = p1.distancia(p2)
          direcao = p1.direcao(p2)

          print(f"Distância {p1} até {p2} é de {dist}")
          print(f"Direção de {p1} até {p2} é de {direcao} graus")
          ```
        </section>

        <section class="fragments without_ul_style" data-markdown>
          ### Comentários

          - Estamos de fato começando a **utilizar OOP** e não só o paradigma estrutural
          - `Posicao` é quase como **novo tipo** definido por nós: possui uma estrutura de armazenamento, regras de persistência e lógica de manipulação
          - **Mais semântica** ao código porque fica mais claro qual é o ponto de referência para os cálculos
          - `Posicao` agora é um **"first-class citizen"**: entidade que suporta todas as operações disponíveis na linguagem
          - Os clientes não sabem nada sobre os **detalhes de implementação** do objeto Posição
          - Sem saber, tocamos superficialmente num outro ponto: **information hiding**
        </section>

        <section data-markdown>
            ### Information Hiding

            Information hiding is the process of **hiding the details of an object** or function. The hiding of these details **results in an abstraction**, which **reduces the external complexity** and makes the object or function easier to use. In addition, information hiding effectively **decouples** the calling code from the internal workings of the object or function being called, which makes it possible **to change the hidden portions without having to also change the calling code**.
        </section>

        <section class="fragments without_ul_style" data-markdown>
          ### Tirando proveito de Information Hiding



          - Nosso sistema agora precisa considerar aceitar **diferentes unidades de medidas** (quilômetros, milhas e radianos) e **diferentes geometria** (plana, esférica e elíptica).
          - As geometrias esperam sempre os ângulos em radianos (sistemas de coordenadas esféricas)
        </section>

        <section>
          <img width="80%" src="images/geometria_esferica.png">
        </section>

        <section class="fragments without_ul_style" data-markdown>
          ### Exemplo 004 - o que acham?

          ```python
          import math

          class Posicao():
              PLANA, ESFERICA, ELIPTICA = 'plana', 'esferica', 'eliptica'
              KM, M, MILHAS = 'kms', 'm', 'miles'

              def __init__(self, lat, lng):
                  self.lat, self.lng = lat, lng
                  self.geometria = self.PLANA
                  self.unidade = self.KM

              @property
              def lat(self):
                return math.degree(self.phi)

              @lat.setter
              def lat(self, value):
                self.phi = math.radians(value)

              @property
              def phi(self):
                 return self._phi

              @phi.setter
              def phi(self, value):
                if not -math.pi / 2 <= value <= math.pi / 2:
                  raise ValueError("Latitude inválida")
                self._phi = value

              @property
              def lng(self):
                return math.degree(self.theta)

              @lng.setter
              def lng(self, value):
                 self.theta = math.radians(value)

              @property
              def theta(self):
                 return self._theta

              @theta.setter
              def theta(self, value):
                if not -math.pi  <= value <= math.pi :
                  raise ValueError("Longitude inválida")
                self._theta = value

              def distancia(self, pos):
                 if self.geometria == self.PLANA:
                   # calcula a distância conciderando a geometria plana
                 elif self.geometria == self.ESFERICA:
                   # calcula a distância conciderando a geometria esférica
                 else:
                   # calcula a distância considerando a geometria elíptica
                 if self.unidade == self.KM:
                   # converte a distância para kms
                 elif self.unidade == self.MILHAS:
                   # converte a distância para milhas
                 else:
                   # converte a distância para metros

              def direcao(self, pos):
                 if self.geometria == self.PLANA:
                   # calcula a direção conciderando a geometria plana
                 elif self.geometria == self.ESFERICA:
                   # calcula a direção conciderando a geometria esférica
                 else:
                   # calcula a direção considerando a geometria elíptica
          ```
        </section>

        <section data-markdown>
          ```python
          p1 = Posicao(12.0123, 36.12313)
          p2 = Posicao(12.5123, 34.00000)

          dist = p1.distancia(p2)
          direcao = p1.direcao(p2)

          print(f"Distância {p1} até {p2} é de {dist} utilizando quiometros e geometria plana")
          print(f"Direção de {p1} até {p2} é de {direcao} graus")

          p1.geometria = Posicao.ESFERICA
          p1.unidade = Posicao.MILHAS
          dist = p1.distancia(p2)
          direcao = p1.direcao(p2)

          print(f"Distância {p1} até {p2} é de {dist} utilizando milhas e geometria esférica")
          print(f"Direção de {p1} até {p2} é de {direcao} graus")
          ```
        </section>

        <section class="fragments without_ul_style" data-markdown>
          ### Comentários

          - **Os clientes não mudaram** e continuam achando que `Posicao` só possui latitudes e longitudes
          - Latitude e longitude deixaram de ser dados do objeto e sim **derivações e modificadores** dos dados
          - Expor a posição via as propriades **escondem os detalhes de implementação** do objeto
          - Vocês gostaram de como estamos calculando as distâncais e direções?
        </section>

        <section class="fragments without_ul_style" data-markdown>
          ### Melhorando o Design: Responsabilidades

          - A **visão de OOP limitada ao bom encapsulamento** ainda pode nos fazer **gerar código de difícil manutenção**
          - Quanto **trabalho** teremos para adicionar mais um tipo de Geometria na nossa classe `Posicao`?
          - A tendência é acabarmos com **classes grandes**, com **vários métodos**, cada um **interagindo com os dados de maneira específica**
          - Já ouviram falar sobre `Bloated models`? --> Data-driven design
          - Qual a alternativa? --> Responsability-driven design
        </section>

        <section class="fragments without_ul_style" data-markdown>
          ### Definindo responsabilidades

          **Responsibility-driven design** is a design technique in object-oriented programming, which improves encapsulation by using the client–server model. It **focuses on the contract** by considering **the actions that the object is responsible for** and the **information that the object shares**.
        </section>

        <section class="fragments without_ul_style" data-markdown>
          ### Quais responsabilidades vemos aqui?

          ```python
          import math

          class Posicao():
              PLANA, ESFERICA, ELIPTICA = 'plana', 'esferica', 'eliptica'
              KM, M, MILHAS = 'kms', 'm', 'miles'

              def __init__(self, lat, lng):
                  self.lat, self.lng = lat, lng
                  self.geometria = self.PLANA
                  self.unidade = self.KM

              @property
              def lat(self):
                return math.degree(self.phi)

              @lat.setter
              def lat(self, value):
                self.phi = math.radians(value)

              @property
              def phi(self):
                 return self._phi

              @phi.setter
              def phi(self, value):
                if not -math.pi / 2 <= value <= math.pi / 2:
                  raise ValueError("Latitude inválida")
                self._phi = value

              @property
              def lng(self):
                return math.degree(self.theta)

              @lng.setter
              def lng(self, value):
                 self.theta = math.radians(value)

              @property
              def theta(self):
                 return self._theta

              @theta.setter
              def theta(self, value):
                if not -math.pi  <= value <= math.pi :
                  raise ValueError("Longitude inválida")
                self._theta = value

              def distancia(self, pos):
                 if self.geometria == self.PLANA:
                   # calcula a distância conciderando a geometria plana
                 elif self.geometria == self.ESFERICA:
                   # calcula a distância conciderando a geometria esférica
                 else:
                   # calcula a distância considerando a geometria elíptica
                 if self.unidade == self.KM:
                   # converte a distância para kms
                 elif self.unidade == self.MILHAS:
                   # converte a distância para milhas
                 else:
                   # converte a distância para metros

              def direcao(self, pos):
                 if self.geometria == self.PLANA:
                   # calcula a direção conciderando a geometria plana
                 elif self.geometria == self.ESFERICA:
                   # calcula a direção conciderando a geometria esférica
                 else:
                   # calcula a direção considerando a geometria elíptica
          ```
        </section>

        <section class="fragments without_ul_style" data-markdown>
          ### Uma possível API

          ```python
          class GemotriaBase():

              def distancia(self, phi_1, theta_1, phi_2, theta_2):
                  """
                  calcula a distância e retorna o valor bruto
                  """
                  pass

              def direcao(self, phi_1, theta_1, phi_2, theta_2):
                  """
                  calcula a direção de 1 em relação a 2
                  """
                  pass

          class UnidadeBase():

              def converte(self, valor_bruto):
                  """
                  converte um valor bruto para a unidade de medida
                  """
          ```
        </section>

        <section class="" data-markdown>
          ### Uma possível refatoração (!!!!decomposição e generalização!!!!)

          ```python
          import math

          class Posicao():

              def __init__(self, lat, lng):
                  self.lat, self.lng = lat, lng
                  self.geometria = GeometriaPlana()
                  self.unidade = UnidadeQuilometro()

              @property
              def lat(self):
                return math.degree(self.phi)

              @lat.setter
              def lat(self, value):
                self.phi = math.radians(value)

              @property
              def phi(self):
                 return self._phi

              @phi.setter
              def phi(self, value):
                if not -math.pi / 2 <= value <= math.pi / 2:
                  raise ValueError("Latitude inválida")
                self._phi = value

              @property
              def lng(self):
                return math.degree(self.theta)

              @lng.setter
              def lng(self, value):
                 self.theta = math.radians(value)

              @property
              def theta(self):
                 return self._theta

              @theta.setter
              def theta(self, value):
                if not -math.pi  <= value <= math.pi :
                  raise ValueError("Longitude inválida")
                self._theta = value

              def distancia(self, pos):
                 dist = self.geometria.distance(self.phi, self.theta, pos.phi, pos.theta)
                 return self.unidade.converte(dist)

              def direcao(self, pos):
                 return self.geometria.direcao(self.phi, self.theta, pos.phi, pos.theta)
          ```
        </section>

        SOBRE acoplamento (alto vs baixo)
          Degree (grau de conexão entre objetos)
          Ease (how obvious the connections are)
          Flexibility (o quão customizável e modificável é o seu objeto e o quanto ele está aberto a extensão)

        coesão  -->  clareza sobre a responsabilidade do objeto
        alta vs baixa coesão

        separation of concerns (exemplo de mercados)  -->  separamos saber a posição de saber calcular as distâncias e direções


        <section>
          <h2>Obrigado!</h2>
          <h3>
            <br/>
            <p>Bernardo Fontes (Berin)</p>
            <br/>
            <p><a target="_blank" href="http://berinfontes.com/">berinfontes.com</a></p>
            <p><a target="_blank" href="https://twitter.com/bbfontes">twitter.com/bbfontes</a></p>
            <p><a target="_blank" href="https://github.com/berinhard">github.com/berinhard</a></p>
            <p><a target="_blank" href="mailto:bernardoxhc@gmail.com">bernardoxhc@gmail.com</a></p>
          </h3>
        </section>

      </div>

    </div>

    <script src="../lib/js/head.min.js"></script>
    <script src="../js/reveal.min.js"></script>

    <script>

      // Full list of configuration options available here:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        controls: false,
        progress: true,
        history: true,
        center: true,

        theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
        // transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/fade/none
        transition: 'zoom',

        // Parallax scrolling
        // parallaxBackgroundImage: 'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg',
        // parallaxBackgroundSize: '2100px 900px',

        // Optional libraries used to extend on reveal.js
        dependencies: [
        { src: 'lib/js/classList.js',
          condition: function() { return !document.body.classList; } },
        { src: '../plugin/markdown/marked.js',
          condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
        { src: '../plugin/markdown/markdown.js',
          condition: function() { return !!document.querySelector( '[data-markdown]' ); },
          callback: function() {
            Array.prototype.forEach.call(
            document.querySelectorAll('section.fragments > ul > li'),
              function(ele){ ele.className = 'fragment roll-in'; });
            } },
        { src: '../plugin/highlight/highlight.js', async: true,
          callback: function() { hljs.initHighlightingOnLoad(); } },
        { src: '../plugin/zoom-js/zoom.js', async: true,
          condition: function() { return !!document.body.classList; } },
        { src: '../plugin/notes/notes.js', async: true,
          condition: function() { return !!document.body.classList; } }
        ]
      });

    </script>
  </body>
</html>
